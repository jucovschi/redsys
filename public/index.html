<html>
  <head>
    <link href="lib/jquery-ui/css/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css">
    <link href="ace/style.css" rel="stylesheet" type="text/css">
    <link href="jquery/css/smoothness/jquery-ui-1.10.0.custom.css" rel="stylesheet" type="text/css">
    <title>Code editor</title>
    <script src="/lib/require.js"></script>
    <script src="/lib/jquery-ui/jquery.js"></script>
    <script src="/lib/jquery-ui/jquery-ui-min.js"></script>
  </head>

  <script>
    require.config({
      baseUrl: ".",
      shim: {
        "/share/Changeset.js": {
          deps: ["/share/AttributePool.js"]
        },
        "/share/share.uncompressed.js": {
          deps: ["/channel/bcsocket.js", "/share/Changeset.js"]
        },
        "/share/ace.js": {
          deps: ["/share/share.uncompressed.js"]
        },
        "/lib/ace/mode-latex.js": {
          deps: ["/lib/ace/ace.js"]
        },
        "/lib/ace/keybinding-emacs.js": {
          deps: ["/lib/ace/ace.js"]
        },
        "/lib/ace/theme-idle_fingers.js": {
          deps: ["/lib/ace/ace.js"]
        }
      },
    });

    require(["redsys", "editor", "lib/async", "sally"], function(redsys, Editor, async, Sally) {
      var editor = null;

      var q = new Sally();
      q.init();
      async.waterfall([
          function (callback) { redsys.setProject("sample_project", callback); }, 
          function (callback) { editor = new Editor("editor", redsys); editor.open("energy.tex", callback); },
          function (callback) { 
            editor.addShortcut("save", "C-x C-s", function(ace) {
              editor.save();
            });
          }
        ]);
      $("#save").click(function() {
        editor.save();
      });
    });
  </script>

  <body>
    <div id="header">

    <button id="save">Save</button>
    </div>

    <div id="content">
      <div id="filebrowser"></div>
      <div id="editor">Loading...</div>
    </div>

  </body>
</html>  

